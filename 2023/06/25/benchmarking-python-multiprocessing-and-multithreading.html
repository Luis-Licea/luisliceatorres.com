<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Benchmarking Python multiprocessing and multithreading | Luis D. Licea Torres</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Benchmarking Python multiprocessing and multithreading" />
<meta name="author" content="Luis David Licea Torres" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I benchmarked the Fibonacci sequence using multiprocessing and multithreading. I found that multiprocessing was faster than multithreading by approximately a factor of p, where p is the number of processes or threads. In other words, five processes working on one task each will finish approximately five times faster than five threads working on one task each, where the given tasks require the same number of calculations to complete. Creating processes was relatively slow compared to creating threads, but the time it took to create the processes was negligible when executing long-running programs." />
<meta property="og:description" content="I benchmarked the Fibonacci sequence using multiprocessing and multithreading. I found that multiprocessing was faster than multithreading by approximately a factor of p, where p is the number of processes or threads. In other words, five processes working on one task each will finish approximately five times faster than five threads working on one task each, where the given tasks require the same number of calculations to complete. Creating processes was relatively slow compared to creating threads, but the time it took to create the processes was negligible when executing long-running programs." />
<link rel="canonical" href="https://luisliceatorres.com/2023/06/25/benchmarking-python-multiprocessing-and-multithreading.html" />
<meta property="og:url" content="https://luisliceatorres.com/2023/06/25/benchmarking-python-multiprocessing-and-multithreading.html" />
<meta property="og:site_name" content="Luis D. Licea Torres" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-06-25T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Benchmarking Python multiprocessing and multithreading" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Luis David Licea Torres"},"dateModified":"2023-06-25T00:00:00+00:00","datePublished":"2023-06-25T00:00:00+00:00","description":"I benchmarked the Fibonacci sequence using multiprocessing and multithreading. I found that multiprocessing was faster than multithreading by approximately a factor of p, where p is the number of processes or threads. In other words, five processes working on one task each will finish approximately five times faster than five threads working on one task each, where the given tasks require the same number of calculations to complete. Creating processes was relatively slow compared to creating threads, but the time it took to create the processes was negligible when executing long-running programs.","headline":"Benchmarking Python multiprocessing and multithreading","mainEntityOfPage":{"@type":"WebPage","@id":"https://luisliceatorres.com/2023/06/25/benchmarking-python-multiprocessing-and-multithreading.html"},"url":"https://luisliceatorres.com/2023/06/25/benchmarking-python-multiprocessing-and-multithreading.html"}</script>
<!-- End Jekyll SEO tag -->
<link id="main-stylesheet" rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://luisliceatorres.com/feed.xml" title="Luis D. Licea Torres" />

<!-- Add favicons. -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/common-favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/common-favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/common-favicon/favicon-16x16.png">
<link rel="manifest" href="/assets/common-favicon/site.webmanifest">
<link rel="mask-icon" href="/assets/common-favicon/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#ffc40d">
<meta name="msapplication-TileImage" content="/assets/common-favicon/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">
<!-- Add theme color switch HTML. -->
<script src="/assets/common-js/switch-html-adder.js" defer></script>
<!-- Add theme color switch JS. -->
<script src="/assets/common-js/switch.js" defer></script>
<!-- Add theme color switch CSS. -->
<link rel="stylesheet" href="/assets/common-css/switch.css">
</head>
<body><header class="site-header">

  <div class="wrapper">
    <a class="site-title" rel="author" href="/">Luis D. Licea Torres</a>
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon"></span>
        </label>

        <div class="nav-items">
  <a class="nav-item" href="/resume.html">Résumé</a>
</div>

      </nav>
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Benchmarking Python multiprocessing and multithreading</h1>
    <div class="post-meta">
      <time class="dt-published" datetime="2023-06-25T00:00:00+00:00" itemprop="datePublished">
        Jun 25, 2023
      </time>
      <div class="force-inline post-authors">
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Luis David Licea Torres</span></span>
      </div>
    </div>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>I benchmarked the Fibonacci sequence using multiprocessing and multithreading. I
found that multiprocessing was faster than multithreading by approximately a
factor of <em>p</em>, where <em>p</em> is the number of processes or threads. In other words,
five processes working on one task each will finish approximately five times
faster than five threads working on one task each, where the given tasks require
the same number of calculations to complete. Creating processes was relatively
slow compared to creating threads, but the time it took to create the processes
was negligible when executing long-running programs.</p>

<p>The table shows the speed of 5 processes and 5 threads each independently
calculating the 25-th term of the Fibonacci sequence.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 fibonacci.py 25 5
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>multithreading</td>
      <td>0sec 027ms</td>
    </tr>
    <tr>
      <td>multiprocessing</td>
      <td>0sec 033ms</td>
    </tr>
  </tbody>
</table>

<p>The table shows the speed of 5 processes and 5 threads each independently
calculating the 30-th term of the Fibonacci sequence.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 fibonacci.py 30 5
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>multiprocessing</td>
      <td>13sec 143ms</td>
    </tr>
    <tr>
      <td>multithreading</td>
      <td>66sec 397ms</td>
    </tr>
  </tbody>
</table>

<p>The results show that multiprocessing is faster than multithreading for
long-running programs by a factor of <em>p</em>, where <em>p</em> is the number of processes
or threads. This means that multiprocessing should be used in situations where
processes can work independently, like processing data and writing it to
different files.</p>

<h2 id="implementations">Implementations</h2>

<details>
<summary>Python</summary>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#!/usr/bin/python3
</span><span class="s">"""Benchmark ProcessPoolExecutor and ThreadPoolExecutor performance."""</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">from</span> <span class="nn">concurrent.futures.process</span> <span class="kn">import</span> <span class="n">ProcessPoolExecutor</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">perf_counter</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>


<span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">term</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="s">"""Calculate the n-th term of the Fibonacci sequence.

    Args:
        term (int): The sequence number to produce. Don't use large
        numbers as the time complexity is exponential.

    Returns:
        int: The sequence number.
    """</span>
    <span class="n">match</span> <span class="n">term</span><span class="p">:</span>
        <span class="n">case</span> <span class="n">term</span> <span class="k">if</span> <span class="n">term</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">case</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="n">case</span> <span class="n">_</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">term</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">term</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">intense_task</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="s">"""Simulates a CPU-intensive operation.

    Args:
        value (int): Some value that will increase CPU work exponentially.
    """</span>
    <span class="n">fibonacci</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">timeit</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="bp">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
    <span class="s">"""Time how long a function takes to execute.

    Args:
        func (callable): The function to time.

    Returns:
        The wrapped function result.
    """</span>
    <span class="o">@</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">timeit_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">total_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Function </span><span class="si">{</span><span class="n">func</span><span class="p">.</span><span class="n">__name__</span><span class="si">}{</span><span class="n">args</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s"> Took </span><span class="si">{</span><span class="n">total_time</span><span class="p">:.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">timeit_wrapper</span>

<span class="o">@</span><span class="n">timeit</span>
<span class="k">def</span> <span class="nf">multiprocessing</span><span class="p">(</span><span class="n">max_workers</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">iterations</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="s">"""Perform a time-intensive task using multiprocessing.

    Args:
        max_workers (int): The max number of process workers.
        iterations (int): The number of times to repeat the operation.
    """</span>
    <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">executor</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="n">intense_task</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">))</span>

<span class="o">@</span><span class="n">timeit</span>
<span class="k">def</span> <span class="nf">multithreading</span><span class="p">(</span><span class="n">max_workers</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">iterations</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="s">"""Perform a time-intensive task using multithreading.

    Args:
        max_workers (int): The max number of thread workers.
        iterations (int): The number of times to repeat the operation.
    """</span>
    <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">executor</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="n">intense_task</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="s">"""Benchmark multithreading and multiprocessing on the same function."""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">iterations</span><span class="p">,</span> <span class="n">max_workers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">multiprocessing</span><span class="p">(</span><span class="n">max_workers</span><span class="p">,</span> <span class="n">iterations</span><span class="p">)</span>
        <span class="n">multithreading</span><span class="p">(</span><span class="n">max_workers</span><span class="p">,</span> <span class="n">iterations</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">IndexError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Usage: </span><span class="si">{</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s"> &lt;iterations&gt; &lt;max_wokers&gt;"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Example: </span><span class="si">{</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s"> 30 5"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span></code></pre></figure>

</details>

  </div>

  <a class="u-url" href="/2023/06/25/benchmarking-python-multiprocessing-and-multithreading.html" hidden></a>
</article>

      </div>
    </main><link id="fa-stylesheet" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css">

<footer class="site-footer h-card">
  <data class="u-url" value="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <ul class="contact-list">
          <li class="p-name">Luis David Licea Torres</li>
          <li><a class="u-email" href="mailto:luisliceatorres@gmail.com">luisliceatorres@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>A portfolio website for projects and blogs.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
    <a rel="me" href="" target="_blank" title="">
      <span class="grey fa-brands fa- fa-lg"></span>
    </a>
  </li><li>
    <a rel="me" href="" target="_blank" title="">
      <span class="grey fa-brands fa- fa-lg"></span>
    </a>
  </li>
  <li>
    <a href="https://luisliceatorres.com/feed.xml" target="_blank" title="Subscribe to syndication feed">
      <svg class="svg-icon grey" viewbox="0 0 16 16">
        <path d="M12.8 16C12.8 8.978 7.022 3.2 0 3.2V0c8.777 0 16 7.223 16 16h-3.2zM2.194
          11.61c1.21 0 2.195.985 2.195 2.196 0 1.21-.99 2.194-2.2 2.194C.98 16 0 15.017 0
          13.806c0-1.21.983-2.195 2.194-2.195zM10.606
          16h-3.11c0-4.113-3.383-7.497-7.496-7.497v-3.11c5.818 0 10.606 4.79 10.606 10.607z"
        />
      </svg>
    </a>
  </li>
</ul>
</div>

  </div>

</footer>

</body>

</html>
